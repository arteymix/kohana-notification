/**
 * errors and notifications should be initialized in the <head> tag before the
 * document ready event is launched. If you want to handle notifications
 * yourself, just don't initialize them :P
 * 
 * Add a copy of this file in your static files.
 * 
 * @type Notification
 * 
 * @author  Guillaume Poirier-Morency <guillaumepoiriermorency@gmail.com>
 * @license BSD 3 clauses
 */
var Notification = {
    ERROR: 'error',
    SUCCESS: 'success',
    INFO: 'info',
    WARNING: 'warning',
    errors: {},
    notifications: [],
    /**
     * Add a new notification.
     * 
     * @param string level
     * @param string message
     */
    add: function(level, message) {

        this.notifications.append({
            'level': level,
            'message': message
        });

        var button = $('<button>').attr({
            'type': 'button',
            'class': 'close',
            'data-dismiss': 'alert'});

        var alert = $('<div/>')
                .attr('class', 'alert alert-' + level)
                .text(message)
                .append(button);

        $('#notifications').append(alert);
    }
};

(function($) {
    $(document).ready(function() {

        for (notification in Notification.notifications) {

            var button = $('<button>').attr({
                'type': 'button',
                'class': 'close',
                'data-dismiss': 'alert'});

            var alert = $('<div/>')
                    .attr('class', 'alert alert-' + notification.level)
                    .text(notification.message)
                    .append(button);

            $('#notifications').append(alert);
        }

        for (key in errors) {

            var errors = Notification.errors[key];

            if (!$.isArray(errors)) {
                errors = [errors];
            }

            // Any [] containing words and their content
            var controlGroup = $("[name$='[" + key + "]']")
                    .add("[name$='[" + key.replace(/\[\w+\]/, "") + "]']")
                    .addClass("lol")
                    .blur(function() {
                        $(this).parents(".control-group").first().removeClass("error")

                    }) // Remove error on blur
                    .parents(".control-group")
                    .first()
                    .addClass("error");
            $.each(errors, function(key, value) {
                // value is a message, key is an index it must be capitalized          
                controlGroup.append('<span class="help-inline">' + value.charAt(0).toUpperCase() + value.slice(1) + '</span>');
            });
        }

    });
})(window.jQuery);